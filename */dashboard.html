<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Work Days Tracker - Dashboard</title>
  <style>
    :root {
      --primary: #1565c0;
      --primary-dark: #0d47a1;
      --bg: #f5f9ff;
      --text: #1a1a1a;
      --accent: #e3f2fd;
      --shadow: rgba(0, 80, 200, 0.15);
      --border-radius: 0.75rem;
      --font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    * { box-sizing: border-box; }
    body, html {
      margin: 0; padding: 0;
      font-family: var(--font-family);
      background: var(--bg);
      color: var(--text);
    }
    header {
      height: 56px;
      background: var(--primary);
      color: white;
      display: flex;
      align-items: center;
      padding: 0 1rem;
      position: fixed;
      width: 100%;
      top: 0;
      z-index: 10;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }
    header .hamburger {
      font-size: 1.8rem;
      cursor: pointer;
      margin-right: 1rem;
    }
    header .title { flex-grow: 1; font-weight: 700; font-size: 1.3rem; }
    header button.logout {
      background: transparent; border: none; color: white; font-weight: 700;
      cursor: pointer; padding: 0.25rem 0.75rem; border-radius: var(--border-radius);
    }
    nav.sidebar {
      position: absolute; top: 56px; left: 1rem;
      width: 200px; background: white;
      border: 1px solid var(--accent);
      box-shadow: 0 4px 12px var(--shadow);
      border-radius: var(--border-radius);
      padding: 1rem;
      display: none; flex-direction: column; gap: 0.75rem;
      z-index: 100;
    }
    nav.sidebar.open { display: flex; }
    nav.sidebar button {
      background: var(--primary); color: white; border: none;
      padding: 0.6rem 1rem; border-radius: var(--border-radius);
      cursor: pointer; font-weight: 700;
    }
    main.content {
      margin-top: 70px; padding: 1rem; max-width: 600px; margin-left: auto; margin-right: auto;
    }
    main.content section {
      background: white; padding: 1.5rem; border-radius: var(--border-radius);
      box-shadow: 0 0 12px var(--shadow); margin-bottom: 2rem;
    }
    main.content label { display: block; font-weight: 600; margin-top: 0.5rem; }
    main.content input, main.content select, main.content button {
      width: 100%; padding: 0.75rem; margin-top: 0.25rem; margin-bottom: 1rem;
      border-radius: var(--border-radius); border: 1px solid #ccc;
    }
    main.content button { background: var(--primary); color: white; font-weight: 700; border: none; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 0.5rem; border-bottom: 1px solid #ccc; }
    th { background: var(--primary); color: white; text-align: left; }
    .fab {
      position: fixed; bottom: 20px; right: 20px;
      background: var(--primary); color: white;
      border-radius: 50%; width: 50px; height: 50px;
      font-size: 26px; border: none; cursor: pointer;
    }
  </style>
</head>
<body>
  <header>
    <div class="hamburger">&#9776;</div>
    <div class="title">Work Days Tracker</div>
    <button class="logout">Logout</button>
  </header>

  <nav class="sidebar">
    <button onclick="navigateTo('settings.html')">Settings</button>
    <button onclick="navigateTo('payslip.html')">Payslip</button>
  </nav>

  <main class="content">
    <section>
      <h2>Shift Entry</h2>
      <label for="shift-date">Date</label>
      <input type="date" id="shift-date" />
      <label for="shift-hours">Hours Worked</label>
      <input type="number" id="shift-hours" min="0" max="24" step="0.25" />
      <label for="holiday-type">Holiday Type</label>
      <select id="holiday-type">
        <option value="none">None</option>
        <option value="legal">Legal Holiday</option>
        <option value="special">Special Holiday</option>
      </select>
      <button id="btn-submit-shift">Submit Shift</button>
    </section>

    <section>
      <h2>Saved Shifts</h2>
      <table id="shifts-table">
        <thead>
          <tr><th>Date</th><th>Hours</th><th>Holiday</th><th>Actions</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </section>
  </main>

  <button class="fab">â†‘</button>

  <script>
    let currentUserEmail = sessionStorage.getItem('currentUserEmail');
    if (!currentUserEmail) { alert("Not logged in"); window.location.href="index.html"; }

    const hamburger = document.querySelector('.hamburger');
    const sidebar = document.querySelector('.sidebar');
    const logoutBtn = document.querySelector('.logout');

    hamburger.addEventListener('click', ()=> sidebar.classList.toggle('open'));
    document.addEventListener('click', e=>{
      if (!sidebar.contains(e.target) && !hamburger.contains(e.target)) sidebar.classList.remove('open');
    });
    function navigateTo(page){ sidebar.classList.remove('open'); window.location.href=page; }
    logoutBtn.addEventListener('click', ()=>{ sessionStorage.removeItem('currentUserEmail'); window.location.href="index.html"; });

    function getUsers(){ return JSON.parse(localStorage.getItem('users')||'{}'); }
    function saveUsers(u){ localStorage.setItem('users', JSON.stringify(u)); }
    function getShifts(){ return getUsers()[currentUserEmail]?.shifts || []; }
    function saveShifts(s){ let u=getUsers(); u[currentUserEmail].shifts=s; saveUsers(u); }

    const shiftsTableBody=document.querySelector('#shifts-table tbody');
    function loadShifts(){
      const shifts=getShifts();
      shiftsTableBody.innerHTML='';
      if(shifts.length===0){ shiftsTableBody.innerHTML="<tr><td colspan=4>No shifts</td></tr>"; return;}
      shifts.forEach((s,i)=>{
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${s.date}</td><td>${s.hours_worked}</td><td>${s.holiday_type}</td>
        <td><button onclick="editShift(${i})">Edit</button> <button onclick="deleteShift(${i})">Delete</button></td>`;
        shiftsTableBody.appendChild(tr);
      });
    }
    loadShifts();

    document.getElementById('btn-submit-shift').addEventListener('click', ()=>{
      const date=document.getElementById('shift-date').value;
      const hours=parseFloat(document.getElementById('shift-hours').value);
      const holiday=document.getElementById('holiday-type').value;
      if(!date||isNaN(hours)){alert("Invalid input"); return;}
      let shifts=getShifts(); 
      const idx=shifts.findIndex(s=>s.date===date);
      if(idx>-1) shifts[idx]={date,hours_worked:hours,holiday_type:holiday};
      else shifts.push({date,hours_worked:hours,holiday_type:holiday});
      saveShifts(shifts); loadShifts();
    });

    window.editShift=i=>{
      const s=getShifts()[i];
      document.getElementById('shift-date').value=s.date;
      document.getElementById('shift-hours').value=s.hours_worked;
      document.getElementById('holiday-type').value=s.holiday_type;
      window.scrollTo(0,0);
    }
    window.deleteShift=i=>{
      if(!confirm("Delete shift?")) return;
      let shifts=getShifts(); shifts.splice(i,1); saveShifts(shifts); loadShifts();
    }
  </script>
</body>
</html>
